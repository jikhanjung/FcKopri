# FcKopri Database Management

ì´ ë””ë ‰í† ë¦¬ëŠ” FcKopri í”„ë¡œì íŠ¸ì˜ ë°ì´í„°ë² ì´ìŠ¤ ê´€ë¦¬ ì‹œìŠ¤í…œì…ë‹ˆë‹¤.

## ğŸ“ ë””ë ‰í† ë¦¬ êµ¬ì¡°

```
sql/
â”œâ”€â”€ complete_schema_v1.1.3.sql    # ğŸ¯ ì™„ì „í•œ DB ìŠ¤í‚¤ë§ˆ (v1.1.3)
â”œâ”€â”€ migrations/                   # ğŸ”„ ìƒˆë¡œìš´ ë§ˆì´ê·¸ë ˆì´ì…˜ë“¤ (v1.1.4+)
â”œâ”€â”€ setup/                       # âš™ï¸ ì¼íšŒì„± ì„¤ì • íŒŒì¼ë“¤
â”‚   â”œâ”€â”€ 00_migration_tracker.sql  # ë§ˆì´ê·¸ë ˆì´ì…˜ ì¶”ì  í…Œì´ë¸”
â”‚   â”œâ”€â”€ 20_storage_setup.sql      # Supabase Storage ì„¤ì •
â”‚   â””â”€â”€ 30_security_policies.sql  # ë³´ì•ˆ ì •ì±…
â”œâ”€â”€ seeds/                       # ğŸŒ± ìƒ˜í”Œ/í…ŒìŠ¤íŠ¸ ë°ì´í„°
â”‚   â””â”€â”€ 99_sample_data.sql
â”œâ”€â”€ archive/                     # ğŸ“¦ ì´ì „ ë²„ì „ ì•„ì¹´ì´ë¸Œ
â”‚   â””â”€â”€ migrations_v1.1.3/       # v1.1.3ê¹Œì§€ì˜ ê°œë³„ ë§ˆì´ê·¸ë ˆì´ì…˜ë“¤
â””â”€â”€ README.md                    # ì´ íŒŒì¼
```

## ğŸš€ ìƒˆë¡œìš´ í™˜ê²½ ì„¤ì • (ê¶Œì¥)

### 1. ì™„ì „í•œ ìŠ¤í‚¤ë§ˆ ì ìš©
```bash
# Supabase SQL Editorì—ì„œ ì‹¤í–‰
sql/complete_schema_v1.1.3.sql
```

### 2. í•„ìˆ˜ ì„¤ì • ì ìš©
```bash
# ìˆœì„œëŒ€ë¡œ ì‹¤í–‰
sql/setup/00_migration_tracker.sql
sql/setup/20_storage_setup.sql  
sql/setup/30_security_policies.sql
```

### 3. ìƒ˜í”Œ ë°ì´í„° (ì„ íƒì‚¬í•­)
```bash
sql/seeds/99_sample_data.sql
```

## ğŸ”„ ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹œìŠ¤í…œ (v1.1.4+)

### ìƒˆ ê¸°ëŠ¥ ì¶”ê°€ ì‹œ
```bash
# 1. ìƒˆ ë§ˆì´ê·¸ë ˆì´ì…˜ ìƒì„±
npm run migrate:create "add_notification_system"
# â†’ sql/migrations/01_add_notification_system.sql ìƒì„±

# 2. SQL ì‘ì„±
# ... ë§ˆì´ê·¸ë ˆì´ì…˜ íŒŒì¼ì—ì„œ SQL ì‘ì„±

# 3. ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤í–‰
npm run migrate:run

# 4. ìƒíƒœ í™•ì¸
npm run migrate:status
```

## ğŸ“‹ í˜„ì¬ ìŠ¤í‚¤ë§ˆ (v1.1.3) í¬í•¨ ê¸°ëŠ¥

### ğŸ—ï¸ í•µì‹¬ ì‹œìŠ¤í…œ
- **competitions** - ëŒ€íšŒ ì •ë³´ (ì „ë°˜ ì‹œê°„ ì„¤ì • í¬í•¨)
- **teams** - íŒ€ ì •ë³´ (ìˆ¨ê¹€ ê¸°ëŠ¥, ë¬´ì†Œì† íŒ€)
- **players** - ì„ ìˆ˜ ì •ë³´
- **matches** - ê²½ê¸° ì •ë³´ (MOTM, ìœ íŠœë¸Œ ë§í¬)

### âš½ ì‹¤ì‹œê°„ ê²½ê¸° ê´€ë¦¬
- **match_events** - ê³¨/ì–´ì‹œìŠ¤íŠ¸ (ì „ë°˜/í›„ë°˜, ìì±…ê³¨ ì§€ì›)
- **playoff_matches** - í”Œë ˆì´ì˜¤í”„ í† ë„ˆë¨¼íŠ¸

### ğŸ—³ï¸ íˆ¬í‘œ ë° ì˜ˆì¸¡ ì‹œìŠ¤í…œ
- **match_predictions** - ê²½ê¸° ì˜ˆì¸¡ (IP ê¸°ë°˜)
- **champion_votes** - ìš°ìŠ¹íŒ€ íˆ¬í‘œ
- **mvp_votes** - MVP íˆ¬í‘œ (IP ê¸°ë°˜ ì¤‘ë³µ ë°©ì§€)
- **best6_votes** - ë² ìŠ¤íŠ¸6 íˆ¬í‘œ (í¬ì§€ì…˜ë³„)

### ğŸ“¸ ë¯¸ë””ì–´ ì‹œìŠ¤í…œ
- **match_photos** - ê²½ê¸° ì‚¬ì§„
- **team_photos** - íŒ€ ì‚¬ì§„ (ë¡œê³ , ë‹¨ì²´ì‚¬ì§„, í›ˆë ¨ì‚¬ì§„, ì¼ë°˜ì‚¬ì§„)
- **match_videos** - ê²½ê¸°ë³„ ë‹¤ì¤‘ ì˜ìƒ

### ğŸ’¬ ì†Œì…œ ê¸°ëŠ¥
- **comments** - ëŒ“ê¸€ ì‹œìŠ¤í…œ (ê²½ê¸°/ì‚¬ì§„/íŒ€ë³„, ì¤‘ì²© ë‹µê¸€)
- **comment_reactions** - ëŒ“ê¸€ ì¢‹ì•„ìš”/ì‹«ì–´ìš”

### ğŸ”§ ì‹œìŠ¤í…œ
- **schema_migrations** - ë§ˆì´ê·¸ë ˆì´ì…˜ ì¶”ì 

## ğŸ¯ í™˜ê²½ë³„ ì‚¬ìš©ë²•

### í”„ë¡œë•ì…˜ í™˜ê²½
```bash
# ê¸°ì¡´ í™˜ê²½ì´ë©´ ë§ˆì´ê·¸ë ˆì´ì…˜ë§Œ ì‹¤í–‰
npm run migrate:run

# ìƒˆ í™˜ê²½ì´ë©´ ì™„ì „í•œ ìŠ¤í‚¤ë§ˆ ì ìš©
# â†’ complete_schema_v1.1.3.sql ì‹¤í–‰
```

### í…ŒìŠ¤íŠ¸ í™˜ê²½ (ë³„ë„ Supabase í”„ë¡œì íŠ¸)
```bash
# 1. ì™„ì „í•œ ìŠ¤í‚¤ë§ˆ ì ìš©
# â†’ complete_schema_v1.1.3.sqlì„ í…ŒìŠ¤íŠ¸ DBì— ì‹¤í–‰

# 2. ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹œìŠ¤í…œ ì„¤ì •
NEXT_PUBLIC_SUPABASE_URL=https://test-project.supabase.co \
SUPABASE_SERVICE_ROLE_KEY=your-test-key \
npm run migrate:run
```

### ë¡œì»¬ ê°œë°œ í™˜ê²½
```bash
# Supabase ë¡œì»¬ ê°œë°œ ì„œë²„ ì‚¬ìš©ì‹œ
supabase start  # ë¡œì»¬ DB ì‹œì‘
npm run migrate:run  # ë§ˆì´ê·¸ë ˆì´ì…˜ ì ìš©
```

## ğŸ“Š ë§ˆì´ê·¸ë ˆì´ì…˜ ì¶”ì 

ëª¨ë“  ë§ˆì´ê·¸ë ˆì´ì…˜ì€ `schema_migrations` í…Œì´ë¸”ì— ê¸°ë¡:

```sql
-- ì ìš©ëœ ë§ˆì´ê·¸ë ˆì´ì…˜ í™•ì¸
SELECT version, description, applied_at 
FROM schema_migrations 
ORDER BY applied_at DESC;

-- í˜„ì¬ ìŠ¤í‚¤ë§ˆ ë²„ì „ í™•ì¸
SELECT MAX(version) as current_version 
FROM schema_migrations;
```

## âš ï¸ ì¤‘ìš” ì‚¬í•­

### ìƒˆ í™˜ê²½ êµ¬ì¶• ì‹œ
âœ… **ê¶Œì¥**: `complete_schema_v1.1.3.sql` ì‚¬ìš©  
âŒ **ë¹„ê¶Œì¥**: ê°œë³„ ë§ˆì´ê·¸ë ˆì´ì…˜ íŒŒì¼ë“¤ (archive í´ë”ì— ë³´ê´€)

### ê¸°ì¡´ í™˜ê²½ ì—…ë°ì´íŠ¸ ì‹œ
âœ… **ê¶Œì¥**: `npm run migrate:run` ì‚¬ìš©  
âŒ **ë¹„ê¶Œì¥**: ìˆ˜ë™ ìŠ¤í‚¤ë§ˆ ìˆ˜ì •

### íŒŒì¼ ìˆ˜ì • ì‹œ
- `complete_schema_v1.1.3.sql`: ìˆ˜ì • ê¸ˆì§€ (ì™„ì„±ëœ ìŠ¤í‚¤ë§ˆ)
- `migrations/` ìƒˆ íŒŒì¼ë“¤: í•„ìš”ì‹œ ìˆ˜ì • ê°€ëŠ¥ (ì²´í¬ì„¬ ê²½ê³  í‘œì‹œ)

## ğŸ·ï¸ ë²„ì „ ì •ë³´

- **í˜„ì¬ ì™„ì„± ë²„ì „**: v1.1.3 (complete_schema)
- **ë‹¤ìŒ ë§ˆì´ê·¸ë ˆì´ì…˜**: v1.1.4+ (migrations/ í´ë”)
- **ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸**: 2025-07-01

---

**ì´ì œ Django/Railsì²˜ëŸ¼ ê¹”ë”í•œ ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹œìŠ¤í…œìœ¼ë¡œ ì•ˆì „í•˜ê²Œ DBë¥¼ ê´€ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤!**

- ìƒˆ í™˜ê²½: í†µí•© ìŠ¤í‚¤ë§ˆë¡œ ë¹ ë¥¸ êµ¬ì¶•
- ê¸°ì¡´ í™˜ê²½: ë§ˆì´ê·¸ë ˆì´ì…˜ìœ¼ë¡œ ì•ˆì „í•œ ì—…ë°ì´íŠ¸
- ë‹¤ì¤‘ í™˜ê²½: ê°ê° ë…ë¦½ì ìœ¼ë¡œ ì¶”ì  ê´€ë¦¬